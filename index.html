<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-Ruby-Cute">Ruby-Cute</h1>

<p>Ruby-Cute is a set of <em>Commonly Used Tools for Experiments</em>, or
<em>Critically Useful Tools for Experiments</em>, depending on who you ask.
It is a library aggregating various Ruby snippets useful in the context of
(but not limited to) development of experiment software on distributed
systems testbeds such as Grid&#39;5000.</p>

<h2 id="label-Installation">Installation</h2>

<p>From sources:</p>

<pre class="code ruby"><code class="ruby">$ git clone https://github.com/ruby-cute/ruby-cute
$ cd ruby-cute
$ gem build ruby-cute.gemspec
$ gem install ruby-cute-*.gem</code></pre>

<p>In Grid&#39;5000 the installation procedure goes as follows:</p>

<pre class="code ruby"><code class="ruby">$ gem install --user-install ruby-cute-*.gem</code></pre>

<p>Then, type the following for having ruby cute in your path (this is only
necessary if you want to use interactive mode).</p>

<pre class="code ruby"><code class="ruby">$ export PATH=$PATH:$(ruby -e &#39;puts &quot;#{Gem.user_dir}/bin&quot;&#39;)</code></pre>

<h2 id="label-Overview">Overview</h2>

<p>Ruby-Cute is structured in different modules that allows you to:</p>
<ul><li>
<p>communicate with Grid&#39;5000 through the G5K Module. For more details
please refer to  <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/G5K/API">G5K
Module</a>.</p>
</li><li>
<p>execute commands in several remote machines in parallel. Two modules are
available for that:</p>
<ul><li>
<p><a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Net/SSH/Multi">Net::SSH::Multi</a>
that uses the SSH protocol.</p>
</li><li>
<p><a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/TakTuk">Taktuk</a>
which is a wrapper of <a href="http://taktuk.gforge.inria.fr">taktuk</a>
parallel command executor.</p>
</li></ul>
</li></ul>

<p>An example of use of Ruby-Cute in a real use case is available in <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/file/examples/g5k_exp_virt.rb">Virtualization
on Grid’5000</a></p>

<h2 id="label-Using+pry+--+an+interactive+ruby+shell">Using pry – an interactive ruby shell</h2>

<p>Sometimes it may be useful to work in interactive mode. For this we can use
an interactive ruby shell such as irb that is shipped by default with Ruby,
however, we highly recommend to use <a href="http://pryrepl.org/">pry</a>,
it features syntax highlighting, method auto completion and command shell
integration. For installing pry type the following:</p>

<pre class="code ruby"><code class="ruby">$ gem install pry</code></pre>

<p>or, for installing in the user home directory:</p>

<pre class="code ruby"><code class="ruby">$ gem install --user-install pry</code></pre>

<p>When Ruby-Cute is installed, it provides a wrapper for an interactive shell
that will automatically load the necessary libraries. The following will
get a <em>pry</em> prompt (if installed).</p>

<pre class="code ruby"><code class="ruby">$ cute
[1] pry(main)&gt;</code></pre>

<p>The variable <em>$g5k</em> is available which can be used to access the
Grid&#39;5000 API through the <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/G5K/API">G5K
Module</a>. For example, let&#39;s request the name of the sites available
in Grid&#39;5000.</p>

<pre class="code ruby"><code class="ruby">[2] pry(main)&gt; $g5k.site_uids()
 =&gt; [&quot;grenoble&quot;, &quot;lille&quot;, &quot;luxembourg&quot;, &quot;lyon&quot;, &quot;nancy&quot;, &quot;nantes&quot;, &quot;reims&quot;, &quot;rennes&quot;, &quot;sophia&quot;, &quot;toulouse&quot;]
</code></pre>

<p>We can get the status of nodes in a given site by using:</p>

<pre class="code ruby"><code class="ruby">[8] pry(main)&gt; $g5k.nodes_status(&quot;lyon&quot;)
 =&gt; {&quot;taurus-2.lyon.grid5000.fr&quot;=&gt;&quot;besteffort&quot;, &quot;taurus-16.lyon.grid5000.fr&quot;=&gt;&quot;besteffort&quot;, &quot;taurus-15.lyon.grid5000.fr&quot;=&gt;&quot;besteffort&quot;, ...}
</code></pre>

<p>Within this shell you have preloaded <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/G5K/API">G5K
Module</a>, <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/TakTuk">Taktuk</a>
and <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Net/SSH/Multi">Net::SSH::Multi</a>,
you can go directly to their respective documentation to know how to take
advantage of them.</p>

<h3 id="label-Experiment+example">Experiment example</h3>

<p>The following example shows how to use the <a
href="http://www.rubydoc.info/github/ruby-cute/ruby-cute/master/Cute/G5K/API">G5K
Module</a> in an experiment. This example implements the experiment
described in <a
href="https://www.grid5000.fr/mediawiki/index.php/Run_MPI_On_Grid%275000#Setting_up_and_starting_Open_MPI_to_use_high_performance_interconnect">MPI
on Grid5000</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cute</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/scp</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_g5k'>g5k</span> <span class='op'>=</span> <span class='const'>Cute</span><span class='op'>::</span><span class='const'>G5K</span><span class='op'>::</span><span class='const'>API</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='comment'># We reuse a job if there is one available.
</span><span class='const'>G5K_SITE</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nancy</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># the chosen site has to have Infiniband 20G (e.g nancy, grenoble)
</span><span class='kw'>if</span> <span class='id identifier rubyid_g5k'>g5k</span><span class='period'>.</span><span class='id identifier rubyid_get_my_jobs'>get_my_jobs</span><span class='lparen'>(</span><span class='const'>G5K_SITE</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
   <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='id identifier rubyid_g5k'>g5k</span><span class='period'>.</span><span class='id identifier rubyid_reserve'>reserve</span><span class='lparen'>(</span><span class='symbol'>:site</span> <span class='op'>=&gt;</span> <span class='const'>G5K_SITE</span><span class='comma'>,</span> <span class='symbol'>:resources</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{ib20g=&#39;YES&#39;}/nodes=2/core=1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='symbol'>:walltime</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>00:30:00</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:keys</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~/my_ssh_jobkey</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
<span class='kw'>else</span>
   <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='id identifier rubyid_g5k'>g5k</span><span class='period'>.</span><span class='id identifier rubyid_get_my_jobs'>get_my_jobs</span><span class='lparen'>(</span><span class='const'>G5K_SITE</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_nodes'>nodes</span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>assigned_nodes</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

<span class='id identifier rubyid_grid5000_opt'>grid5000_opt</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:user</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:keys</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~/my_ssh_jobkey</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='int'>6667</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_machine_file'>machine_file</span> <span class='op'>=</span> <span class='const'>Tempfile</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>machine_file</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_node'>node</span><span class='op'>|</span> <span class='id identifier rubyid_machine_file'>machine_file</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_node'>node</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_machine_file'>machine_file</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

<span class='id identifier rubyid_netpipe'>netpipe</span> <span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://pkgs.fedoraproject.org/repo/pkgs/NetPIPE/NetPIPE-3.7.1.tar.gz/5f720541387be065afdefc81d438b712/NetPIPE-3.7.1.tar.gz</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># We use the first node reserved.
</span><span class='const'>Net</span><span class='op'>::</span><span class='const'>SCP</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_grid5000_opt'>grid5000_opt</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_scp'>scp</span><span class='op'>|</span>
   <span class='id identifier rubyid_scp'>scp</span><span class='period'>.</span><span class='id identifier rubyid_upload!'>upload!</span> <span class='id identifier rubyid_machine_file'>machine_file</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/machine_file</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='const'>Net</span><span class='op'>::</span><span class='const'>SSH</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_nodes'>nodes</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_grid5000_opt'>grid5000_opt</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ssh'>ssh</span><span class='op'>|</span>
   <span class='id identifier rubyid_ssh'>ssh</span><span class='period'>.</span><span class='id identifier rubyid_exec!'>exec!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mkdir -p netpipe_exp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
   <span class='id identifier rubyid_ssh'>ssh</span><span class='period'>.</span><span class='id identifier rubyid_exec!'>exec!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>export http_proxy=\&quot;http://proxy:3128\&quot;; wget -O ~/netpipe_exp/NetPIPE.tar.gz </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_netpipe'>netpipe</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
   <span class='id identifier rubyid_ssh'>ssh</span><span class='period'>.</span><span class='id identifier rubyid_exec!'>exec!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cd netpipe_exp &amp;&amp; tar -zvxf NetPIPE.tar.gz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
   <span class='id identifier rubyid_ssh'>ssh</span><span class='period'>.</span><span class='id identifier rubyid_exec!'>exec!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cd netpipe_exp/NetPIPE-3.7.1 &amp;&amp; make mpi</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
   <span class='id identifier rubyid_ssh'>ssh</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mpirun --mca plm_rsh_agent \&quot;oarsh\&quot; -machinefile /tmp/machine_file ~/netpipe_exp/NetPIPE-3.7.1/NPmpi</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_g5k'>g5k</span><span class='period'>.</span><span class='id identifier rubyid_release'>release</span><span class='lparen'>(</span><span class='id identifier rubyid_job'>job</span><span class='rparen'>)</span> <span class='comment'># Frees resources.
</span></code></pre>

<h2 id="label-Contact+information">Contact information</h2>

<p>Ruby-Cute is maintained by the Algorille team at LORIA/Inria Nancy - Grand
Est, and specifically by:</p>
<ul><li>
<p>Sébastien Badia <a
href="mailto:sebastien.badia@inria.fr">sebastien.badia@inria.fr</a></p>
</li><li>
<p>Tomasz Buchert <a
href="mailto:tomasz.buchert@inria.fr">tomasz.buchert@inria.fr</a></p>
</li><li>
<p>Emmanuel Jeanvoine <a
href="mailto:emmanuel.jeanvoine@inria.fr">emmanuel.jeanvoine@inria.fr</a></p>
</li><li>
<p>Lucas Nussbaum <a
href="mailto:lucas.nussbaum@loria.fr">lucas.nussbaum@loria.fr</a></p>
</li><li>
<p>Luc Sarzyniec <a
href="mailto:luc.sarzyniec@inria.fr">luc.sarzyniec@inria.fr</a></p>
</li><li>
<p>Cristian Ruiz <a
href="mailto:cristian.ruiz@inria.fr">cristian.ruiz@inria.fr</a></p>
</li></ul>

<p>Questions/comments should be directed to Lucas Nussbaum and Emmanuel
Jeanvoine.</p>
</div></div>

    <div id="footer">
  Generated on Tue Mar 10 14:09:42 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.4).
</div>

  </body>
</html>